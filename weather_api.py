# #http://api.weatherapi.com/v1/forecast.json?key=61636f7026c1432ebc355947221907&q=Yekaterinburg&days=4&aqi=no&alerts=no
# #Ye - 1486209
from datetime import datetime
import requests
import locale
import pytz

locale.setlocale(locale.LC_ALL, "ru_RU")


# s_city = "Yekaterinburg"
# city_id = 0
# appid = "61636f7026c1432ebc355947221907"

################################################################################
def time_now_tz(current_tz):
    time_now = int(datetime.now(tz=current_tz).strftime('%H'))
    return time_now


################################################################################


################################################################################
#
# ะะพะณะพะดะฐ ะฟะพ ัะฐัะฐะผ(ะฝะฐ 6 ัะฐัะพะฒ)
#
################################################################################
def hours_weather():
    s_city = "Yekaterinburg"
    appid = "61636f7026c1432ebc355947221907"
    temp_text_onHours = []
    hours_all = []
    temp_text = ''
    temp_msg = ''
    global weather_codes

    ekb_tz = pytz.timezone('Asia/Yekaterinburg')
    ###########################
    try:
        res = requests.get("https://api.weatherapi.com/v1/forecast.json",
                           params={
                               'key': appid,
                               'q': s_city,
                               'days': '2',
                               'aqi': 'no',
                               'alerts': 'no'
                           })
        data = res.json()
        # print('###################Hello###################')

        for i in data['forecast']['forecastday']:
            for j in i['hour']:
                hour_time = j['time']
                hour_tmp = j['temp_c']
                hour_feeling = j['feelslike_c']
                hour_is_day = j['is_day']
                hour_text = j['condition']['code']
                hour_rainChace = j['chance_of_rain']
                # hour_is_rain = j['will_it_rain']
                # hour_snowChace = j['chance_of_snow']

                ##ัะตะบัั ะฟะพะณะพะดั##
                for i in weather_codes:
                    if i['code'] == int(hour_text):
                        hour_text = i[str(hour_is_day)]
                        break
                ################

                hour_time_to_date = datetime.strptime(hour_time, '%Y-%m-%d %H:%M')
                now_utc = pytz.utc.localize(hour_time_to_date)
                ftime_now = datetime.strftime(now_utc, '%H:%M')

                ##ะผะฐััะธะฒ ะฒัะตะผะตะฝ##
                ftime_all = datetime.strftime(now_utc, '%H')
                hours_all.append(int(ftime_all) + 7)
                # print(ftime_all)
                #################

                if hour_rainChace > 0:
                    ##ะทะฐะฟะธัั ัะตะบััะฐ ะฝะฐ ะฒัะฒะพะด ะฒ ะผะฐััะธะฒ##
                    temp_text = f'-------------------{ftime_now}-------------------\n' \
                                f'{hour_tmp}ยฐC, ะพัััะฐะตััั ะบะฐะบ {hour_feeling}ยฐC\n' \
                                f'{hour_text}\n' \
                                f'๐ง ะะตัะพััะฝะพััั ะดะพะถะดั: {hour_rainChace}%\n' \
                                f'-------------------------------------------\n\n'
                    temp_text_onHours.append(temp_text)
                    ###################################
                else:
                    ##ะทะฐะฟะธัั ัะตะบััะฐ ะฝะฐ ะฒัะฒะพะด ะฒ ะผะฐััะธะฒ##
                    temp_text = f'-------------------{ftime_now}-------------------\n' \
                                f'{hour_tmp}ยฐC, ะพัััะฐะตััั ะบะฐะบ {hour_feeling}ยฐC\n' \
                                f'{hour_text}\n' \
                                f'-------------------------------------------\n\n'
                    temp_text_onHours.append(temp_text)
                    ###################################

        time_now = time_now_tz(ekb_tz)

        for i in range(time_now, time_now + 7):
            temp_msg += temp_text_onHours[i]

        return temp_msg

    ##############################
    except Exception as e:
        temp_text += 'ะะดะตะผ ะพัะฒะตั ะพั ัะตัะฒะตัะฐ..ะะธะดะธะผะพ ััะพ-ัะพ ะฝะต ัะฐะฑะพัะฐะตั('
        print("ะัะธะฑะบะฐ:", e)
        return temp_text
        pass


################################################################################
#
# ะะพะณะพะดะฐ ะฝะฐ ะฝะตะดะตะปั(ะฝะฐ ััะธ ะดะฝั ะฒะฟะตัะตะด)
#
################################################################################
def weekday_weather():
    s_city = "Yekaterinburg"
    appid = "61636f7026c1432ebc355947221907"
    global will_it_rain
    temp_onWeek = []
    temp_text = ''
    temp_msg = ''
    try:
        res = requests.get("https://api.weatherapi.com/v1/forecast.json",
                           params={
                               'key': appid,
                               'q': s_city,
                               'days': '7',
                               'aqi': 'no',
                               'alerts': 'no'
                           })
        data = res.json()

        for i in data['forecast']['forecastday']:
            date_epoch_sec = i['date_epoch']
            date_weather_time = datetime.utcfromtimestamp(date_epoch_sec).strftime('%A, %d %B')

            date_max_temp = i['day']['maxtemp_c']
            date_min_temp = i['day']['mintemp_c']
            date_rain_chance = i['day']['daily_chance_of_rain']
            date_is_rain = will_it_rain[i['day']['daily_will_it_rain']]

            ##ะทะฐะฟะธัั ัะตะบััะฐ ะฝะฐ ะฒัะฒะพะด ะฒ ะผะฐััะธะฒ##
            if date_rain_chance > 0:
                temp_text = f'{date_weather_time} {date_is_rain}\n' \
                            f'ะะตัะพััะฝะพััั ะดะพะถะดั: {date_rain_chance}%\n' \
                            f'ะะฐะบัะธะผะฐะปัะฝะฐั ัะตะผะฟะตัะฐัััะฐ: {date_max_temp}ยฐC\n' \
                            f'ะะธะฝะธะผะฐะปัะฝะฐั ัะตะผะฟะตัะฐัััะฐ: {date_min_temp}ยฐC\n' \
                            f'-------------------------------------------\n\n\n'
                temp_onWeek.append(temp_text)

            else:
                temp_text = f'{date_weather_time} {date_is_rain}\n' \
                            f'ะะฐะบัะธะผะฐะปัะฝะฐั ัะตะผะฟะตัะฐัััะฐ: {date_max_temp}ยฐC\n' \
                            f'ะะธะฝะธะผะฐะปัะฝะฐั ัะตะผะฟะตัะฐัััะฐ: {date_min_temp}ยฐC\n' \
                            f'-------------------------------------------\n\n\n'
                temp_onWeek.append(temp_text)
            ###################################

        for i in range(3):
            temp_msg += temp_onWeek[i]

        return temp_msg

    except Exception as e:
        temp_text += 'ะะดะตะผ ะพัะฒะตั ะพั ัะตัะฒะตัะฐ..ะะธะดะธะผะพ ััะพ-ัะพ ะฝะต ัะฐะฑะพัะฐะตั('
        print("Exception (find):", e)
        return temp_text
        pass


################################################################################


will_it_rain = [
    "โ ",  # ะฝะตั ะดะพะถะดั
    "๐ง"  # ะดะพะถะดั
]

weather_codes = [
    {
        "code": 1000,
        "1": "ะกะพะปะฝะตัะฝะพ โ",  # ะดะตะฝั
        "0": "ะฏัะฝะพ ๐",  # ะฝะพัั
        "icon": 113
    },
    {
        "code": 1003,
        "1": "ะะตัะตะผะตะฝะฝะฐั ะพะฑะปะฐัะฝะพััั ๐ค",
        "0": "ะะตัะตะผะตะฝะฝะฐั ะพะฑะปะฐัะฝะพััั ๐ค",
        "icon": 116
    },
    {
        "code": 1006,
        "1": "ะะฑะปะฐัะฝะพ โ",
        "0": "ะะฑะปะฐัะฝะพ โ",
        "icon": 119
    },
    {
        "code": 1009,
        "1": "ะะฐัะผััะฝะพ โโโ",
        "0": "ะะฐัะผััะฝะพ โโโ",
        "icon": 122
    },
    {
        "code": 1030,
        "1": "ะัะผะบะฐ",
        "0": "ะัะผะบะฐ",
        "icon": 143
    },
    {
        "code": 1063,
        "1": "ะะตััะฐะผะธ ะดะพะถะดั ๐ง",
        "0": "ะะตััะฐะผะธ ะดะพะถะดั ๐ง",
        "icon": 176
    },
    {
        "code": 1066,
        "1": "ะะตััะฐะผะธ ัะฝะตะณ ๐จ",
        "0": "ะะตััะฐะผะธ ัะฝะตะณ ๐จ",
        "icon": 179
    },
    {
        "code": 1069,
        "1": "ะะตััะฐะผะธ ะดะพะถะดั ัะพ ัะฝะตะณะพะผ ๐ง",
        "0": "ะะตััะฐะผะธ ะดะพะถะดั ัะพ ัะฝะตะณะพะผ ๐ง",
        "icon": 182
    },
    {
        "code": 1072,
        "1": "ะะตััะฐะผะธ ะทะฐะผะตัะทะฐััะฐั ะผะพัะพัั ๐ง",
        "0": "ะะตััะฐะผะธ ะทะฐะผะตัะทะฐััะฐั ะผะพัะพัั ๐ง",
        "icon": 185
    },
    {
        "code": 1087,
        "1": "ะะตััะฐะผะธ ะณัะพะทั ๐ฉ",
        "0": "ะะตััะฐะผะธ ะณัะพะทั ๐ฉ",
        "icon": 200
    },
    {
        "code": 1114,
        "1": "ะะพะทัะผะพะบ",
        "0": "ะะพะทัะผะพะบ",
        "icon": 227
    },
    {
        "code": 1117,
        "1": "ะะตัะตะปั ๐ช",
        "0": "ะะตัะตะปั ๐ช",
        "icon": 230
    },
    {
        "code": 1135,
        "1": "ะขัะผะฐะฝ ๐ซ",
        "0": "ะขัะผะฐะฝ ๐ซ",
        "icon": 248
    },
    {
        "code": 1147,
        "1": "ะะตัะตะพัะปะฐะถะดะตะฝะฝัะน ััะผะฐะฝ",
        "0": "ะะตัะตะพัะปะฐะถะดะตะฝะฝัะน ััะผะฐะฝ",
        "icon": 260
    },
    {
        "code": 1150,
        "1": "ะะตััะฐะผะธ ัะปะฐะฑะฐั ะผะพัะพัั ๐ฆ",
        "0": "ะะตััะฐะผะธ ัะปะฐะฑะฐั ะผะพัะพัั ๐ฆ",
        "icon": 263
    },
    {
        "code": 1153,
        "1": "ะกะปะฐะฑะฐั ะผะพัะพัั ๐ฆ",
        "0": "ะกะปะฐะฑะฐั ะผะพัะพัั ๐ฆ",
        "icon": 266
    },
    {
        "code": 1168,
        "1": "ะะฐะผะตัะทะฐััะฐั ะผะพัะพัั ๐ง",
        "0": "ะะฐะผะตัะทะฐััะฐั ะผะพัะพัั ๐ง",
        "icon": 281
    },
    {
        "code": 1171,
        "1": "ะกะธะปัะฝะฐั ะทะฐะผะตัะทะฐััะฐั ะผะพัะพัั ๐ง๐ง๐ง",
        "0": "ะกะธะปัะฝะฐั ะทะฐะผะตัะทะฐััะฐั ะผะพัะพัั ๐ง๐ง๐ง",
        "icon": 284
    },
    {
        "code": 1180,
        "1": "ะะตััะฐะผะธ ะฝะตะฑะพะปััะพะน ะดะพะถะดั ๐ง",
        "0": "ะะตััะฐะผะธ ะฝะตะฑะพะปััะพะน ะดะพะถะดั ๐ง",
        "icon": 293
    },
    {
        "code": 1183,
        "1": "ะะตะฑะพะปััะพะน ะดะพะถะดั ๐ง",
        "0": "ะะตะฑะพะปััะพะน ะดะพะถะดั ๐ง",
        "icon": 296
    },
    {
        "code": 1186,
        "1": "ะัะตะผะตะฝะฐะผะธ ัะผะตัะตะฝะฝัะน ะดะพะถะดั ๐ง",
        "0": "ะัะตะผะตะฝะฐะผะธ ัะผะตัะตะฝะฝัะน ะดะพะถะดั ๐ง",
        "icon": 299
    },
    {
        "code": 1189,
        "1": "ะฃะผะตัะตะฝะฝัะน ะดะพะถะดั ๐ง๐ง",
        "0": "ะฃะผะตัะตะฝะฝัะน ะดะพะถะดั ๐ง๐ง",
        "icon": 302
    },
    {
        "code": 1192,
        "1": "ะัะตะผะตะฝะฐะผะธ ัะธะปัะฝัะน ะดะพะถะดั ๐ง๐ง",
        "0": "ะัะตะผะตะฝะฐะผะธ ัะธะปัะฝัะน ะดะพะถะดั ๐ง๐ง",
        "icon": 305
    },
    {
        "code": 1195,
        "1": "ะกะธะปัะฝัะน ะดะพะถะดั ๐ง๐ง๐ง",
        "0": "ะกะธะปัะฝัะน ะดะพะถะดั ๐ง๐ง๐ง",
        "icon": 308
    },
    {
        "code": 1198,
        "1": "ะกะปะฐะฑัะน ะฟะตัะตะพัะปะฐะถะดะตะฝะฝัะน ะดะพะถะดั ๐ง",
        "0": "ะกะปะฐะฑัะน ะฟะตัะตะพัะปะฐะถะดะตะฝะฝัะน ะดะพะถะดั ๐ง",
        "icon": 311
    },
    {
        "code": 1201,
        "1": "ะฃะผะตัะตะฝะฝัะน ะธะปะธ ัะธะปัะฝัะน ะฟะตัะตะพัะปะฐะถะดะตะฝะฝัะน ะดะพะถะดั ๐ง๐ง",
        "0": "ะฃะผะตัะตะฝะฝัะน ะธะปะธ ัะธะปัะฝัะน ะฟะตัะตะพัะปะฐะถะดะตะฝะฝัะน ะดะพะถะดั ๐ง๐ง",
        "icon": 314
    },
    {
        "code": 1204,
        "1": "ะะตะฑะพะปััะพะน ะดะพะถะดั ัะพ ัะฝะตะณะพะผ ๐ง",
        "0": "ะะตะฑะพะปััะพะน ะดะพะถะดั ัะพ ัะฝะตะณะพะผ ๐ง",
        "icon": 317
    },
    {
        "code": 1207,
        "1": "ะฃะผะตัะตะฝะฝัะน ะธะปะธ ัะธะปัะฝัะน ะดะพะถะดั ัะพ ัะฝะตะณะพะผ ๐ง๐จ",
        "0": "ะฃะผะตัะตะฝะฝัะน ะธะปะธ ัะธะปัะฝัะน ะดะพะถะดั ัะพ ัะฝะตะณะพะผ ๐ง๐จ",
        "icon": 320
    },
    {
        "code": 1210,
        "1": "ะะตััะฐะผะธ ะฝะตะฑะพะปััะพะน ัะฝะตะณ ๐จ",
        "0": "ะะตััะฐะผะธ ะฝะตะฑะพะปััะพะน ัะฝะตะณ ๐จ",
        "icon": 323
    },
    {
        "code": 1213,
        "1": "ะะตะฑะพะปััะพะน ัะฝะตะณ ๐จ",
        "0": "ะะตะฑะพะปััะพะน ัะฝะตะณ ๐จ",
        "icon": 326
    },
    {
        "code": 1216,
        "1": "ะะตััะฐะผะธ ัะผะตัะตะฝะฝัะน ัะฝะตะณ ๐จ",
        "0": "ะะตััะฐะผะธ ัะผะตัะตะฝะฝัะน ัะฝะตะณ ๐จ",
        "icon": 329
    },
    {
        "code": 1219,
        "1": "ะฃะผะตัะตะฝะฝัะน ัะฝะตะณ ๐จ๐จ",
        "0": "ะฃะผะตัะตะฝะฝัะน ัะฝะตะณ ๐จ๐จ",
        "icon": 332
    },
    {
        "code": 1222,
        "1": "ะะตััะฐะผะธ ัะธะปัะฝัะน ัะฝะตะณ ๐จ๐จ",
        "0": "ะะตััะฐะผะธ ัะธะปัะฝัะน ัะฝะตะณ ๐จ๐จ",
        "icon": 335
    },
    {
        "code": 1225,
        "1": "ะกะธะปัะฝัะน ัะฝะตะณ ๐จ๐จ๐จ",
        "0": "ะกะธะปัะฝัะน ัะฝะตะณ ๐จ๐จ๐จ",
        "icon": 338
    },
    {
        "code": 1237,
        "1": "ะะตะดัะฝะพะน ะดะพะถะดั ๐ง",
        "0": "ะะตะดัะฝะพะน ะดะพะถะดั ๐ง",
        "icon": 350
    },
    {
        "code": 1240,
        "1": "ะะตะฑะพะปััะพะน ะปะธะฒะฝะตะฒัะน ะดะพะถะดั ๐ง",
        "0": "ะะตะฑะพะปััะพะน ะปะธะฒะฝะตะฒัะน ะดะพะถะดั ๐ง",
        "icon": 353
    },
    {
        "code": 1243,
        "1": "ะฃะผะตัะตะฝะฝัะน ะธะปะธ ัะธะปัะฝัะน ะปะธะฒะฝะตะฒัะน ะดะพะถะดั ๐ง๐ง",
        "0": "ะฃะผะตัะตะฝะฝัะน ะธะปะธ ัะธะปัะฝัะน ะปะธะฒะฝะตะฒัะน ะดะพะถะดั ๐ง๐ง",
        "icon": 356
    },
    {
        "code": 1246,
        "1": "ะกะธะปัะฝัะต ะปะธะฒะฝะธ ๐ง๐ง๐ง",
        "0": "ะกะธะปัะฝัะต ะปะธะฒะฝะธ ๐ง๐ง๐ง",
        "icon": 359
    },
    {
        "code": 1249,
        "1": "ะะตะฑะพะปััะพะน ะปะธะฒะฝะตะฒัะน ะดะพะถะดั ัะพ ัะฝะตะณะพะผ ๐ง",
        "0": "ะะตะฑะพะปััะพะน ะปะธะฒะฝะตะฒัะน ะดะพะถะดั ัะพ ัะฝะตะณะพะผ ๐ง",
        "icon": 362
    },
    {
        "code": 1252,
        "1": "ะฃะผะตัะตะฝะฝัะต ะธะปะธ ัะธะปัะฝัะต ะปะธะฒะฝะตะฒัะต ะดะพะถะดะธ ัะพ ัะฝะตะณะพะผ ๐ง",
        "0": "ะฃะผะตัะตะฝะฝัะต ะธะปะธ ัะธะปัะฝัะต ะปะธะฒะฝะตะฒัะต ะดะพะถะดะธ ัะพ ัะฝะตะณะพะผ ๐ง",
        "icon": 365
    },
    {
        "code": 1255,
        "1": "ะะตะฑะพะปััะพะน ัะฝะตะณ ๐จ",
        "0": "ะะตะฑะพะปััะพะน ัะฝะตะณ ๐จ",
        "icon": 368
    },
    {
        "code": 1258,
        "1": "ะฃะผะตัะตะฝะฝัะน ะธะปะธ ัะธะปัะฝัะน ัะฝะตะณ ๐จ๐จ",
        "0": "ะฃะผะตัะตะฝะฝัะน ะธะปะธ ัะธะปัะฝัะน ัะฝะตะณ ๐จ๐จ",
        "icon": 371
    },
    {
        "code": 1261,
        "1": "ะะตะฑะพะปััะพะน ะปะตะดัะฝะพะน ะดะพะถะดั ๐ง",
        "0": "ะะตะฑะพะปััะพะน ะปะตะดัะฝะพะน ะดะพะถะดั ๐ง",
        "icon": 374
    },
    {
        "code": 1264,
        "1": "ะฃะผะตัะตะฝะฝัะน ะธะปะธ ัะธะปัะฝัะน ะปะตะดัะฝะพะน ะดะพะถะดั ๐ง๐ง",
        "0": "ะฃะผะตัะตะฝะฝัะน ะธะปะธ ัะธะปัะฝัะน ะปะตะดัะฝะพะน ะดะพะถะดั ๐ง๐ง",
        "icon": 377
    },
    {
        "code": 1273,
        "1": "ะ ะพัะดะตะปัะฝัั ัะฐะนะพะฝะฐั ะผะตััะฐะผะธ ะฝะตะฑะพะปััะพะน ะดะพะถะดั ั ะณัะพะทะพะน โโ",
        "0": "ะ ะพัะดะตะปัะฝัั ัะฐะนะพะฝะฐั ะผะตััะฐะผะธ ะฝะตะฑะพะปััะพะน ะดะพะถะดั ั ะณัะพะทะพะน โโ",
        "icon": 386
    },
    {
        "code": 1276,
        "1": "ะ ะพัะดะตะปัะฝัั ัะฐะนะพะฝะฐั ัะผะตัะตะฝะฝัะน ะธะปะธ ัะธะปัะฝัะน ะดะพะถะดั ั ะณัะพะทะพะน โโ",
        "0": "ะ ะพัะดะตะปัะฝัั ัะฐะนะพะฝะฐั ัะผะตัะตะฝะฝัะน ะธะปะธ ัะธะปัะฝัะน ะดะพะถะดั ั ะณัะพะทะพะน โโ",
        "icon": 389
    },
    {
        "code": 1279,
        "1": "ะ ะพัะดะตะปัะฝัั ัะฐะนะพะฝะฐั ะผะตััะฐะผะธ ะฝะตะฑะพะปััะพะน ัะฝะตะณ ั ะณัะพะทะพะน ๐จ๐ฉ",
        "0": "ะ ะพัะดะตะปัะฝัั ัะฐะนะพะฝะฐั ะผะตััะฐะผะธ ะฝะตะฑะพะปััะพะน ัะฝะตะณ ั ะณัะพะทะพะน ๐จ๐ฉ",
        "icon": 392
    },
    {
        "code": 1282,
        "1": "ะ ะพัะดะตะปัะฝัั ัะฐะนะพะฝะฐั ัะผะตัะตะฝะฝัะน ะธะปะธ ัะธะปัะฝัะน ัะฝะตะณ ั ะณัะพะทะพะน ๐จ๐ฉ",
        "0": "ะ ะพัะดะตะปัะฝัั ัะฐะนะพะฝะฐั ัะผะตัะตะฝะฝัะน ะธะปะธ ัะธะปัะฝัะน ัะฝะตะณ ั ะณัะพะทะพะน ๐จ๐ฉ",
        "icon": 395
    }
]




